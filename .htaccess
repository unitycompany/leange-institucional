# --- Força HTTPS ---
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# --- Proxy 1st-party para GTM/GA4 em /metrics ---
# Ex.: /metrics/gtm.js?id=GTM-WWQC764  ->  https://www.googletagmanager.com/gtm.js?id=...
RewriteRule ^metrics/gtm.js$ https://www.googletagmanager.com/gtm.js [P,L]
RewriteRule ^metrics/ns.html$ https://www.googletagmanager.com/ns.html [P,L]
RewriteRule ^metrics/g/collect$ https://www.google-analytics.com/g/collect [P,L]

# (Opcional) Ads/Floodlight:
# RewriteRule ^metrics/pagead/1p-conversion(.*)$ https://googleads.g.doubleclick.net/pagead/1p-conversion$1 [P,L]
# RewriteRule ^metrics/j/collect$ https://www.google-analytics.com/j/collect [P,L]

# --- SPA fallback (React Router) ---
# Entrega /index.html para qualquer rota que não seja arquivo/pasta real e não seja /metrics
RewriteCond %{REQUEST_URI} !^/metrics/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.html [L]
